FundSignal 80/20 MVP — Networked Capture + Offline Consumption

Goal: Unblock Day‑1 by fetching You.com/Tavily data on a networked box and consuming deterministic fixtures everywhere else (sandbox/CI), while baking in freshness, provenance, and security so this evolves cleanly into the long‑term Acquire Service.

⸻

1) Problem Summary
	•	Sandbox has no outbound DNS/network, so You.com/Tavily calls fail.
	•	Day‑1 deliverables (verified leads + confidence) require live calls to generate:
	•	leads/youcom_verified.json
	•	leads/tavily_confirmed.json
	•	leads/day1_output.json
	•	Downstream Day‑2+ work (scoring, delivery, UX/“Freshness Watermark”) depends on those artifacts.

⸻

2) Overall Solution (Two‑Mode Architecture)
	•	Acquisition Mode (networked): Run a capture tool on a safe, team‑owned machine/runner to hit You.com/Tavily and write fixtures + manifest.
	•	Analysis Mode (offline): Pipelines, tests, and the sandbox read from fixtures by default for deterministic builds.

Key refinements from Codex feedback:
	•	Explicit capture cadence + expiry to avoid stale data.
	•	Named modes instead of boolean: FUND_SIGNAL_MODE=online|fixture (extensible to staging|mock).
	•	Provenance: record git_commit, request params, checksums.
	•	Resilience: batching, retries, and --resume in the capture tool.
	•	Storage policy: small anonymized sample fixtures in Git; real data in a private artifact bucket.
	•	Security: documented key storage (1Password or cloud SSM/Vault), never hard‑code locally.
	•	Docs: clarify who runs capture, where, and when.
	•	CI: validate pipelines against fixtures to catch schema drift.

⸻

3) The 80% MVP (Scope & Outcomes)

Delivers 80% of value with ~20% effort:
	1.	Two‑Mode Client: OnlineClient (real APIs) and FixtureClient (local artifacts) behind a NewsClient interface, selected by FUND_SIGNAL_MODE.
	2.	Capture Tool: tools/capture_news.py fetches You.com+Tavily in batches with retry/backoff, can --resume, and writes fixtures + manifest.
	3.	Manifest & Freshness Controls: include captured_at, expiry_days, git_commit, hosts, checksums, counts.
	4.	Offline‑First Pipelines: default to fixture mode in sandbox/CI; use manifest to surface freshness in UI/logs.
	5.	Docs + CI: clear runbook for capture; CI job validates pipelines on fixtures to detect drift.

3.1 MVP Deliverables
	•	pipelines/news_client.py with OnlineClient/FixtureClient.
	•	tools/capture_news.py (batch/retry/resume).
	•	fixtures/ directory structure + manifest.json schema.
	•	docs/network_modes.md detailing roles, cadence, key handling, and storage.
	•	CI job: confidence_scoring runs against fixtures.
	•	Make targets: make capture, make day1, make verify-fixtures.

3.2 Env & Modes

# Extensible and explicit
FUND_SIGNAL_MODE=fixture   # default in sandbox/CI
# FUND_SIGNAL_MODE=online  # only on the capture runner

3.3 Manifest Schema (MVP)

{
  "schema_version": "1.0",
  "captured_at": "2025-11-07T08:30:00Z",
  "expiry_days": 7,
  "git_commit": "<short-sha>",
  "sources": [
    {"name": "youcom", "host": "api.ydc-index.io", "params": {"k": 10}},
    {"name": "tavily", "host": "api.tavily.com", "params": {"k": 10}}
  ],
  "artifacts": [
    {"path": "fixtures/youcom/acme-corp.json", "bytes": 12345, "sha256": "...", "records": 12},
    {"path": "fixtures/tavily/acme-corp.json", "bytes": 6789,  "sha256": "...", "records": 9}
  ],
  "companies": 100,
  "notes": "Generated by tools/capture_news.py --resume"
}

3.4 Fixture Storage Policy (MVP)
	•	Git: Tiny anonymized sample fixtures for unit/integration tests.
	•	Private artifact bucket: Full datasets for 100+ companies (read‑only to sandbox/CI via credentials or pre‑synced files).

3.5 Capture Cadence & Expiry
	•	Cadence: Weekly (Friday 8:00 UTC) and before each release.
	•	Expiry enforcement: Pipelines warn (and CI can fail) if now - captured_at > expiry_days.

⸻

4) Post‑MVP (Remaining 20%)
	•	Signed bundles (KMS/GPG) + promotion flow (dev → prod).
	•	Acquire Service in a VPC with allowlisted egress and scheduled capture → writes to bucket.
	•	Schema registry + validation as a CI gate for new artifacts.
	•	Observability: freshness SLA, provider latency/429s, dedup ratio.
	•	Secrets via SSM/Vault on the capture runner; auto‑rotation.

⸻

5) Work Breakdown (Small Tasks) & Schedule

Day 1 — Abstraction & Modes
	•	Define NewsClient protocol and data types.
	•	Implement OnlineClient (httpx, auth headers, timeouts, retry/backoff).
	•	Implement FixtureClient (read JSON from fixtures/ paths).
	•	Add FUND_SIGNAL_MODE=online|fixture selection & logging of active mode.
	•	Wire pipelines to depend only on NewsClient.

Acceptance: Pipeline runs end‑to‑end in fixture mode using stub data.

Day 2 — Capture Tool (Batch/Resume)
	•	tools/capture_news.py loads companies from leads/exa_seed.json.
	•	Batch execution (configurable concurrency/QPS per provider).
	•	Retries with exponential backoff + jitter; vendor‑specific 429 handling.
	•	--resume flag (skip already captured company files).
	•	Write artifacts to fixtures/{youcom,tavily}/{company}.json.
	•	Generate manifest.json with captured_at, expiry_days, git_commit, checksums, counts.

Acceptance: One command completes capture for a small test set; resume works after forced interruption.

Day 3 — Offline Consumption & CI
	•	Default sandbox/CI to FUND_SIGNAL_MODE=fixture.
	•	Add manifest freshness check; warn/fail if expired.
	•	Update Day‑1 pipeline to output youcom_verified.json, tavily_confirmed.json, day1_output.json from fixtures.
	•	CI job verify-fixtures runs python -m pipelines.day1.confidence_scoring --input=fixtures/... and asserts outputs.
	•	Add small anonymized fixtures to Git for CI; document pulling real fixtures from bucket.

Acceptance: CI green; local sandbox run reproduces outputs deterministically.

Day 4 — Docs, Security & Polish
	•	docs/network_modes.md: roles (who runs capture), cadence, where to run (team runner), how to store keys (1Password/SSM), and storage policy.
	•	Makefile targets: capture (online), day1 (offline), verify-fixtures (CI), refresh-fixtures (pull from bucket).
	•	Log the active git_commit into manifest and pipeline logs.
	•	Optional: surface manifest captured_at and “freshness watermark” in UI.

Acceptance: New contributor can read docs, run capture on the right machine, commit/ship fixtures safely.

⸻

6) File/Folder Layout (MVP)

fundsignal/
  pipelines/
    day1/
      confidence_scoring.py
    news_client.py           # interface + clients
  tools/
    capture_news.py
  fixtures/
    sample/                  # tiny anonymized data for CI
    youcom/
    tavily/
    manifest.json
  leads/
    exa_seed.json
  docs/
    network_modes.md
  Makefile


⸻

7) Make Targets (Examples)

capture:        # online (capture runner only)
	python -m tools.capture_news --input leads/exa_seed.json --out fixtures --expiry-days 7 --resume

day1:           # offline
	python -m pipelines.day1.confidence_scoring --input fixtures

verify-fixtures: # CI guard
	python -m pipelines.day1.confidence_scoring --input fixtures --check

refresh-fixtures: # pull from private bucket (read-only)
	python tools/sync_artifacts.py --from s3://fundsignal-fixtures/current --to ./fixtures


⸻

8) Security Notes (MVP)
	•	Do not store API keys in repo or sandbox.
	•	Capture runner uses keys from 1Password (dev) or SSM/Vault (shared env). Export at runtime only.
	•	Limit egress on the capture runner (allowlist You.com/Tavily) when feasible.

⸻

9) Evolution to Long‑Term Acquire Service
	•	The capture script becomes a scheduled job in a VPC; outputs signed bundles in S3.
	•	FixtureClient points to the latest signed bundle (or a promoted version tag).
	•	Add schema registry, artifact signing/verification, metrics & alerts (freshness SLO).

⸻

10) Risks & Mitigations
	•	Fixture staleness → enforce expiry_days + CI guard + explicit cadence in docs.
	•	Key leakage → team‑owned runner + secrets manager; never run capture inside sandbox.
	•	Vendor API drift → CI job validates schema against fixtures; manual re‑capture before release.

⸻

Decision: Proceed with this MVP now. It unblocks Day‑1, preserves sandbox isolation, and sets a clean path to the hardened acquisition service without rework.